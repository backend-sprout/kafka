# 카프카 버전 업그레이드를 위한 준비
## 카프카 버전 확인 
카프카 버전 업그레이드 전에 버전을 확인할 필요가 있다.     

**명령어를 이용한 방법**  
```shell
/usr/local/kafka/bin/kafka-topcis.sh --version
> 2.6.0 (Commit:62abe01bee039651)
```

**kafka의 libs jar 파일 확인하는 방법**  
```shell
ls -l /usr/local/kafka/libs/kafka_*

> ...2.12-2.6.0-javadoc.jar 
``` 

카프카 버전 확인이 끝났으면, 릴리즈 노트 등을 살펴보면서 업그레이드시 문제가 없는지 확인한다.      
카프카의 상위 버전은 클라이언트들의 하위 호환성을 갖기에 대부분 클라이언트 이슈는 없을 것이다.        
하지만 `스칼라 컨슈머`, `프로듀서`처럼 서비스가 종료된 경우도 있으므로 꼭 릴리즈 노트를 확인하자.   
 
만약, 버저닝이 `0.X` -> `1.X` -> `2.X `와 같은 경우에는       
메시지 포맷 변경, 브로커에서의 기보값 변화, 과거 명령어 지원 종료, 일부 JMX 메트릭의 변화등의 문제가 있을 수 있다.  
하지만, `2.X` -> `2.Y`의 버전 변경일 경우 비교적 용이하게 업그레이드 할 수 있다.      
 
카프카의 버전 업그레이드 방법은 크게      
카프카가 `다운 타임을 가질 수 있는 경우`와 `다운 타임을 가질 수 없는 경우` 2가지로 나눌 수 있다.    
 
다운타임을 가질 수 있다면,      
현재 버전의 카프카를 모두 종료한 후 최신 버전의 카프카를 실행하면 되므로 간단히 업그레이드가 완료된다.  
**하지만 대부분의 경우 카프카의 다운 타임을 갖기란 어렵다.**    

카프카와 연결된 수 많은 파이프라인이나 카프카와 연결된 서비스에 끼칠 영향을 최소화하며           
장애가 일어나지 않도록 장애가 일어나지 않도록 업그레이드를 수행해야한다.         
이런 경우의 해법이라면 브로커 한 대씩 롤링 업그레이드 하는 것이다.      
