# 컨슈머 파티션 할당 전략

프로듀서의 파티셔너는 레코드를 토픽의 어느 파티션으로 전송할지를 결정하는 역할을 했다.      
컨슈머의 동작에서도 이와 유사하게 대상 토픽의 어느 파티션으로부터 레코드를 읽어올지를 결정한다.     
컨슈머 그룹의 리더 컨슈머가 정해진 파티션 할당 전략에 따라 각 컨슈머와 대상 토픽의 파티션을 매칭한다.    
  
파티션 할당 전략은 컨슈머 옵션의 `partition.assignment.strategy`로 표시하며 아래와 같은 전략이 있다.       

* RageAssignor(레인지 전략)
* RoundRobinAssignor(라운드 로빈 전략),   
* StickyAssignor(스티키 전략)
* CooperativeStickyAssignor(협력적 스티키 전략)

|파티션 할당 전략|설명|
|------------|---|
|레인지 파티션 할당 전략|파티션 할당 전략의 기본값으로서, 토픽별로 할당 전략을 사용한다<br>동일한 키를 이용하는 2개 이상의 토픽을 컨슘할 때 유용하다.|
|라운드 로빈 파티션 할당 전략|사용 가능한 파티션과 컨슈머들을 라운드 로빈으로 할당한다.<br>균등한 분배가 가능하다.|
|스티키 파티션 할당 전략|컨슈머가 컨슘하고 있는 파티션을 계속 유지할 수 있다.|
|협력적 스티키 파티션 할당 전략|스티키 방식과 유사하지만,<br>전체 일시 정지가 아닌 연속적인 재조정 방식|

## 레인지 파티션 할당 전략 

레인지 파티션 할당 전략인 RageAssignor는 파티션 할당 전략 중 기본값으로서, 각 토픽별로 할당 전략을 사용하게된다.     
레인지 파티션 할당 전략은 **먼저 구독하는 토픽에 대한 파티션을 순서대로 나열한 후 컨슈머를 순서대로 정렬한다.**       
이후, 각 컨슈머가 몇 개의 파티션을 할당해야하는지 전체 파티션 수를 컨슈머 수로 나눈다.   
컨슈머 수와 파티션 수가 일치하면 균등하게 할당될 수 있지만,     
균등하게 나눠지지 않는 경우에는 앞쪽의 컨슈머들은 추가 파티션을 할당받게된다.  

[](#)
    
이처럼, 불균등한 파티션 할당 전략은 왜 이용할까?       
레인지 파티션 할당 전략은 **동일한 레코드 키(메시지 키)를 사용**하고 있고         
**하나의 컨슈머 그룹이 동일한 파티션 수를 가진 2개 이상의 토픽을 컨슘할 때 유용하다.**      

사례 다시 공부,  
 
레인지 파티션 할당 전략은 방금 설명한  특수한 환경에서 사용하는 것이 좋지만,      
컨슈머에 균등하게 파티션이 분배되지 않으므로 컨슈머 그룹은 불균형한 상태로 운영할 수 있다는 점에 유의해야한다.  

## 라운드 로빈 파티션 전략 

라운드 로빈 파티션 할당 전략은 파티션 할당 전략 중 가장 간단한 할당 방식이다.   


