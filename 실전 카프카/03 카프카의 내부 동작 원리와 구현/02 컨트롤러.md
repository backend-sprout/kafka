# 컨트롤러
         
리더 선출을 맡고 있는 컨트롤러에 대해서 알아보자                 
카프카 클러스터 중 **하나의 브로커가 컨트롤러 역할**을 하게 되며, **파티션의 ISR 리스트 중에서 리더를 선출한다.**            
리더를 선출하기 위한 ISR 리스트 정보는 안전한 저장소에 보관되어 있어야하는데, **가용성 보장을 위해 주키퍼에 저장되어있다.**      
            
컨트롤러는 브로커가 실패하는 것을 예의주시하고 있으며,            
**만약 브로커의 실패가 감지되면 즉시 ISR 리스트 중 하나를 새로운 파티션 리더로 선출한다.**        
그리고 나서, 새로운 리더의 정보를 주키퍼에 기록하고 변경된 정보를 모든 브로커에게 전달한다.       
          
파티션의 리더가 다운됐다는 것은 해당 파티션의 리더가 없는 상태를 의미하며,                  
카프카 클러이언트인 프로듀서나 컨슈머가 해당 파티션으로 읽기나 쓰기가 불가능하다는 것을 의미한다.            
이렇게 카프카 클라이언트가 읽기/쓰기를 하지 못하면 모든 읽기/쓰기 동작은 실패하게 되고,       
클라이언트에 설정되어 있는 재시도 숫자만큼 재시도를 하게 된다.     
          
따라서 클라이언트들이 재시도하는 시간 내에 리더 선출 작업이 빠르게 이뤄줘야합니다.       
그럼 또 하나의 예제를 통해 리더 선출 과정이 어떻게 진행되는지 설명한다.       

예제 토픽은 조금 전 리더에포크 예제에서 사용했던 peter-test02 토픽을 이용하며, 현재 설정된 토픽의 정보는 표 4-1과 같다.    
  
|토픽 이름|peter-test02|    
|-------|------------|   
|파티션 수|1|    
|리플리케이션 팩터 수|2|   
|브로커 배치|1, 3번 브로커|    
|현재 리더 위치|1번 브로커|   
   
   
