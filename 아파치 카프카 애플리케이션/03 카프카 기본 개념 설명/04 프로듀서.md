# 프로듀서 
## 프로듀서 중요 개넘   

프로듀서는 카프카 브로커로 데이터를 전송할 때 내부적으로 파티셔너, 배치 생성 단계를 거친다.         
전송하고자하는 데이터는 ProducerRecord 클래스를 통해 인스턴스를 생성했지만          
ProducerRecord 인스턴스를 **생성 필수 파라미터인 토픽과 메시지 값만 설정했다.**    
 
생성시 추가 파라미터를 사용하여 오버로딩하여 ProducerRecord의 내부 변수를 선언할 수도 있다.   
파티션 번호를 직접 지정하거나 **타임스탬프 설정, 메시지 키를 설정할 수도 있다.**       

레코드의 타임스탬프는 카프카 브로커에 저장될 때 브로커 시간을 기준으로 설정되지만      
필요에 따라 레코드 생성 시간 또는 그 이전/이후로도 설정할 수 있다.    
 
ProducerRecord 인스턴스의 `send()`를 호출하면 **파티셔너에서 토픽의 어느 파티션으로 전송될 것인지 정해진다.**           
KafkaProducer 인스턴스를 생성할 때 파티셔너를 따로 설정하지 않으면 기본값인 DefaultPartitioner로 설정되어 파티션이 정해진다.     
파티셔너에 구분된 레코드는 데이터를 전송하기 전에 어큐뮬레이터에 데이터를 버퍼로 쌓아놓고 발송한다.       
버퍼로 쌓인 데이터는 배치로 묶어 전송함으로써 카프카의 프로듀서 처리량을 향상시키는데에 큰 도움을 준다.    

프로듀서 API를 사용하면, 2가지 파티션을 사용할 수 있다.  

* UniformStickyPartitions 
    * 카프카 클라이언트 2.5.0 버전 이상에서 파티셔너를 지정하지 않는 경우 기본 설정값
* RoundRobinPartitioner  
    * 카프카 클라이언트 2.4.0 버전 이하에서 파티셔너를 지정하지 않는 경우 기본 설정값  
 
메시지 키의 해시값과 파티션을 매칭하여 데이터를 전송한다.    
메시지 키가 없을 경우 파티션에 최대한 동일한 로직이 들어가도록 하는 공통점이 있다.     
단, UniformStickyPartitions 가 RoundRobinPartitioner 의 단점을 개선하였다고 한다.    
  
**UniformStickyPartitions**     
* 프로듀서 동작에 특화되어 높은 처리량과 낮은 리소스 사용률을 가지는 특징이 있다.      
* 될수 있으면 많은 데이터가 배치로 묶여 전송되어야 성능 향상을 기대할 수 있으므로 설정되었다.       
* 어큐뮬레이터에서 데이터가 배치로 모두 묶일 때까지 기다렸다가 배치로 묶인 데이터는 모두 동일한 파티션에 전송한다.   
 
**RoundRobinPartitioner**     
* 들어오는 대로 파티션을 순회하면서 전송하기 때문에 배치로 묶이는 빈도가 적다.    

카프카 클라이언트 라이브러리에서는 사용자 지정 파티셔너를 생성하기 위한 Partitioner 인터페이스를 제공한다.      
Partitioner 인터페이스를 상속받은 사용자 정의 클래스에서 메시지 키 또는 메시지 갑에 따른 파티션 지정 로직을 적용할 수도 있다.  

   



